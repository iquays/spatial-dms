"use strict";!function(t,i){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==i&&i.L&&(i.L.CanvasIconLayer=t(L))}(function(t){var i=(t.Layer?t.Layer:t.Class).extend({initialize:function(i){t.setOptions(this,i)},setOptions:function(i){return t.setOptions(this,i),this._canvas&&this._updateOptions(),this.redraw()},redraw:function(){this._redraw(!0)},addMarker:function(i){t.Util.stamp(i),this._markers||(this._markers={}),this._markers[i._leaflet_id]=i,this._drawMarker(i)},addLayer:function(t){"markerPane"==t.options.pane&&t.options.icon?this.addMarker(t):console.error("Layer isn't a marker")},removeLayer:function(t){this.removeMarker(t,!0)},removeMarker:function(t,i){delete this._markers[t._leaflet_id],i&&this._redraw(!0)},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),this.options.pane?this.getPane().appendChild(this._canvas):t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this)},onRemove:function(t){this.options.pane?this.getPane().removeChild(this._canvas):t.getPanes().overlayPane.removeChild(this._canvas)},addTo:function(t){return t.addLayer(this),this},_drawMarker:function(t){var i=this,a=this._map.latLngToContainerPoint(t.getLatLng());t.canvas_img?i._drawImage(t,a):(t.canvas_img=new Image,t.canvas_img.src=t.options.icon.options.iconUrl,t.canvas_img.onload=function(){i._drawImage(t,a)})},_drawImage:function(t,i){this._context.drawImage(t.canvas_img,i.x-t.options.icon.options.iconAnchor[0],i.y-t.options.icon.options.iconAnchor[1],t.options.icon.options.iconSize[0],t.options.icon.options.iconSize[1])},_reset:function(){var i=this._map.containerPointToLayerPoint([0,0]);t.DomUtil.setPosition(this._canvas,i);var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._redraw()},_redraw:function(t){this._map&&(t&&this._context.clearRect(0,0,this._canvas.width,this._canvas.height),Object.keys(this._markers).forEach(function(t){this._drawMarker(this._markers[t])},this))},_initCanvas:function(){this._canvas=t.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer");var i=t.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);this._canvas.style[i]="50% 50%";var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y,this._context=this._canvas.getContext("2d");var n=this._map.options.zoomAnimation&&t.Browser.any3d;t.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(n?"animated":"hide"))},_updateOptions:function(){}});t.canvasIconLayer=function(t){return new i(t)}},window);